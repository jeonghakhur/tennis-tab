# ë„¤ì´ë²„ OAuth ì„¤ì • ê°€ì´ë“œ

> âš ï¸ **ì£¼ì˜**: ë„¤ì´ë²„ëŠ” Supabaseì—ì„œ ê³µì‹ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì§ì ‘ êµ¬í˜„í•©ë‹ˆë‹¤.  
> ì¹´ì¹´ì˜¤ëŠ” Supabase OAuthë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ë„¤ì´ë²„ ê°œë°œì ì„¼í„° ì„¤ì •

### 1. ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡

1. https://developers.naver.com/apps ì ‘ì†
2. **ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡** í´ë¦­
3. ì •ë³´ ì…ë ¥:
   - **ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„**: Tennis Tab
   - **ì‚¬ìš© API**: ë„¤ì´ë²„ ë¡œê·¸ì¸
   - **ì œê³µ ì •ë³´ ì„ íƒ**: ì´ë©”ì¼, ë‹‰ë„¤ì„, í”„ë¡œí•„ ì‚¬ì§„ (í•„ìˆ˜)

### 2. ì„œë¹„ìŠ¤ í™˜ê²½ ì„¤ì •

**ë¡œê·¸ì¸ ì˜¤í”ˆ API ì„œë¹„ìŠ¤ í™˜ê²½**
- âœ… PC ì›¹ ì„ íƒ

**ì„œë¹„ìŠ¤ URL**
- ê°œë°œ: `http://localhost:3000`
- í”„ë¡œë•ì…˜: `https://your-domain.com`

**Callback URL** (ì¤‘ìš”!)
- ê°œë°œ: `http://localhost:3000/api/auth/naver/callback`
- í”„ë¡œë•ì…˜: `https://your-domain.com/api/auth/naver/callback`

### 3. API í‚¤ ë°œê¸‰

ë“±ë¡ ì™„ë£Œ í›„ ë‹¤ìŒ ì •ë³´ í™•ì¸:
- **Client ID**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡ í™”ë©´ì— í‘œì‹œ
- **Client Secret**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡ í™”ë©´ì— í‘œì‹œ

---

## ğŸ”‘ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env.local` íŒŒì¼ì— ì¶”ê°€:

```env
# ë„¤ì´ë²„ OAuth (ì§ì ‘ êµ¬í˜„)
NAVER_CLIENT_ID=your_client_id_here
NAVER_CLIENT_SECRET=your_client_secret_here
```

**âš ï¸ ì¤‘ìš”**: Client Secretì€ ì ˆëŒ€ í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤!

---

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

ë„¤ì´ë²„ ë¡œê·¸ì¸ ê´€ë ¨ íŒŒì¼:

```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ auth/
â”‚           â””â”€â”€ naver/
â”‚               â”œâ”€â”€ login/
â”‚               â”‚   â””â”€â”€ route.ts          # ë¡œê·¸ì¸ ì‹œì‘
â”‚               â””â”€â”€ callback/
â”‚                   â””â”€â”€ route.ts          # OAuth ì½œë°± ì²˜ë¦¬
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ auth/
â”‚       â””â”€â”€ naver.ts                      # ë„¤ì´ë²„ ì¸ì¦ ë¡œì§
â””â”€â”€ app/
    â””â”€â”€ auth/
        â””â”€â”€ login/
            â””â”€â”€ page.tsx                  # ë¡œê·¸ì¸ í˜ì´ì§€
```

---

## ğŸ”„ OAuth í”Œë¡œìš°

```
1. ì‚¬ìš©ì "ë„¤ì´ë²„ ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­
   â†“
2. /api/auth/naver/login í˜¸ì¶œ
   â†“
3. ë„¤ì´ë²„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
   â†“
4. ì‚¬ìš©ì ë„¤ì´ë²„ì—ì„œ ì¸ì¦
   â†“
5. /api/auth/naver/callback?code=xxx&state=xxx
   â†“
6. Access Token ë°›ê¸°
   â†“
7. ë„¤ì´ë²„ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
   â†“
8. Supabaseì— ì‚¬ìš©ì ìƒì„±/ì—…ë°ì´íŠ¸
   â†“
9. ì„¸ì…˜ ìƒì„± ë° í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

### 1. ê°œë°œ ì„œë²„ ì‹¤í–‰

```bash
yarn dev
```

### 2. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸

1. http://localhost:3000/auth/login ì ‘ì†
2. "ë„¤ì´ë²„ ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­
3. ë„¤ì´ë²„ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
4. ì •ë³´ ì œê³µ ë™ì˜
5. í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í™•ì¸

### 3. ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸

Supabase > Table Editor > profiles í…Œì´ë¸”ì—ì„œ ì‚¬ìš©ì í™•ì¸:

```sql
SELECT id, email, name, avatar_url, role
FROM profiles
WHERE email = 'your-email@naver.com';
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### "Callback URLì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤" ì—ëŸ¬

**ì›ì¸**: ë„¤ì´ë²„ ê°œë°œì ì„¼í„°ì— ë“±ë¡í•œ Callback URLê³¼ ì‹¤ì œ URLì´ ë‹¤ë¦„

**í•´ê²°**:
1. ë„¤ì´ë²„ ê°œë°œì ì„¼í„° > ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜
2. Callback URL í™•ì¸:
   - ê°œë°œ: `http://localhost:3000/api/auth/naver/callback`
   - í”„ë¡œë•ì…˜: `https://your-domain.com/api/auth/naver/callback`

### "ì´ë©”ì¼ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ì—ëŸ¬

**ì›ì¸**: ë„¤ì´ë²„ ë¡œê·¸ì¸ API ì œê³µ ì •ë³´ì— ì´ë©”ì¼ì´ í¬í•¨ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
1. ë„¤ì´ë²„ ê°œë°œì ì„¼í„° > ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜
2. **ì œê³µ ì •ë³´ ì„ íƒ** í™•ì¸
3. **ì´ë©”ì¼ ì£¼ì†Œ** í•„ìˆ˜ ì„ íƒ
4. ë³€ê²½ì‚¬í•­ ì €ì¥

### ì„¸ì…˜ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: Supabase Service Role Keyê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
```env
SUPABASE_SERVICE_ROLE_KEY=sb_secret_your_service_role_key
```

Supabase ëŒ€ì‹œë³´ë“œ > Settings > API > service_role key ë³µì‚¬

### í”„ë¡œí•„ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: `handle_new_user()` íŠ¸ë¦¬ê±°ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
SQL Editorì—ì„œ íŠ¸ë¦¬ê±° í™•ì¸:

```sql
SELECT * FROM pg_trigger
WHERE tgname = 'on_auth_user_created';
```

íŠ¸ë¦¬ê±°ê°€ ì—†ìœ¼ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¬ì‹¤í–‰:
```sql
-- supabase/migrations/00_initial_schema.sql ì „ì²´ ì‹¤í–‰
```

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. Client Secret ë³´í˜¸
- âœ… ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©
- âŒ í´ë¼ì´ì–¸íŠ¸ì— ì ˆëŒ€ ë…¸ì¶œ ê¸ˆì§€
- âœ… í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬

### 2. State íŒŒë¼ë¯¸í„°
- CSRF ê³µê²© ë°©ì§€ë¥¼ ìœ„í•´ ì‚¬ìš©
- í˜„ì¬ êµ¬í˜„: ëœë¤ ë¬¸ìì—´ ìƒì„±
- í”„ë¡œë•ì…˜: ì„¸ì…˜ ê¸°ë°˜ ê²€ì¦ ê¶Œì¥

### 3. HTTPS ì‚¬ìš©
í”„ë¡œë•ì…˜ì—ì„œëŠ” ë°˜ë“œì‹œ HTTPS ì‚¬ìš©:
- Callback URL: `https://` ì‚¬ìš©
- í† í° ì „ì†¡ ì‹œ ì•”í˜¸í™”

---

## ğŸ“Š ì¹´ì¹´ì˜¤ vs ë„¤ì´ë²„ êµ¬í˜„ ë°©ì‹

| í•­ëª© | ì¹´ì¹´ì˜¤ | ë„¤ì´ë²„ |
|------|--------|--------|
| **Supabase ì§€ì›** | âœ… ì§€ì› | âŒ ë¯¸ì§€ì› |
| **êµ¬í˜„ ë°©ì‹** | Supabase OAuth | ì§ì ‘ êµ¬í˜„ |
| **ì½”ë“œ ë³µì¡ë„** | ë‚®ìŒ | ë†’ìŒ |
| **í™˜ê²½ ë³€ìˆ˜** | Dashboardì—ì„œ ì„¤ì • | .env.localì— ì„¤ì • |
| **ìœ ì§€ë³´ìˆ˜** | Supabaseê°€ ê´€ë¦¬ | ì§ì ‘ ê´€ë¦¬ |

---

## ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬

### 1. Vercel í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

Vercel Dashboard > Settings > Environment Variables:

```
NAVER_CLIENT_ID=production_client_id
NAVER_CLIENT_SECRET=production_client_secret
```

### 2. ë„¤ì´ë²„ ê°œë°œì ì„¼í„° ì—…ë°ì´íŠ¸

í”„ë¡œë•ì…˜ ë„ë©”ì¸ ì¶”ê°€:
- ì„œë¹„ìŠ¤ URL: `https://your-domain.com`
- Callback URL: `https://your-domain.com/api/auth/naver/callback`

### 3. ë°°í¬ í›„ í…ŒìŠ¤íŠ¸

1. í”„ë¡œë•ì…˜ ì‚¬ì´íŠ¸ì—ì„œ ë„¤ì´ë²„ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
2. Supabase profiles í…Œì´ë¸” í™•ì¸
3. ë¡œê·¸ í™•ì¸ (Vercel > Logs)

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [ë„¤ì´ë²„ ë¡œê·¸ì¸ API ê°€ì´ë“œ](https://developers.naver.com/docs/login/overview)
- [Supabase Auth ë¬¸ì„œ](https://supabase.com/docs/guides/auth)
- [OAuth 2.0 ìŠ¤í™](https://oauth.net/2/)

---

## ğŸ’¡ ê²°ë¡ 

ë„¤ì´ë²„ ë¡œê·¸ì¸ì€ Supabaseì—ì„œ ê³µì‹ ì§€ì›í•˜ì§€ ì•Šì§€ë§Œ, 
ì§ì ‘ êµ¬í˜„ì„ í†µí•´ ì•ˆì •ì ì¸ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼**:
- âœ… ì¹´ì¹´ì˜¤: Supabase OAuth (ê°„í¸)
- âœ… ë„¤ì´ë²„: ì§ì ‘ êµ¬í˜„ (ì•ˆì •ì )

ë‘ ë°©ì‹ ëª¨ë‘ Supabase profiles í…Œì´ë¸”ê³¼ í†µí•©ë˜ì–´ ì¼ê´€ëœ ì‚¬ìš©ì ê´€ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤!
